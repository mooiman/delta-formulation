%--------------------------------------------------------------------------------
\chapter{Error function needed to regularize the artificial viscosity} \label{sec:error_artificial_viscosity}
%--------------------------------------------------------------------------------
Regularization of the artificial viscosity, assumed to be independent of time, is described in \autoref{sec:regularization_artificial_viscosity}.
The mentioned error-function is derived in this section and is based on \citet[eq.\ 42]{Borsboom2001}:

We start from the continuity and momentum equation for non-linear waves (i.e. \autoref{eq:continuity_equation} and \eqref{eq:momentum_equation} and combine these two equations to one equation representing the energy.

The continuity and momentum equation read:
\begin{align}
    \pdiff{h}{t}  + \pdiff{q}{x} & = 0 \qquad \textit{continuity eq.}
    \\
    \pdiff{q}{t}  + \pdiff{}{x} \left( \frac{q^2}{h} \right) + g h \pdiff{h}{x} & = 0 \qquad \textit{momentum eq.}
\end{align}
a suitable combination of these two equations yields the energy equation.
The suitable combination is:
\begin{align}
    \left( \half \frac{q^2}{h^2} + g \zeta\right)\left(\textit{continuity eq.}\right)
    +
    \frac{q}{h} \left( \textit{momentum eq.} \right)= 0
\end{align}
and the energy equation reads:
\begin{align}
    \pdiff{}{t}\left( h \left(\half \frac{q^2}{h^2} + g \zeta - \half g h \right) \right) +
    \pdiff{}{x}\left( q \left( \half \frac{q^2}{h^2} + g\zeta  \right) \right)= 0
\end{align}
For a steady state solution ($\lpdiff{}{t} = 0$ and $q=\textit{Constant}$), when have:
\begin{align}
    &\pdiff{}{x}\left( \frac{1}{2} \frac{q^2}{h^2} + g\zeta  \right) =
\frac{q}{h^2} \pdiff{q}{x} - \frac{q^2}{h^3}  \pdiff{h}{x} + g\pdiff{\zeta}{x} = 0
\end{align}
We assume that the artificial viscosity $\Psi$ is proportional to the numerical error of the gradient term.
%
%--------------------------------------------------------------------------------
\paragraph*{Based on potential energy}
Looking to square root of the potential energy
\begin{align}
    {\it Err}\left(\sqrt{g\hhat}\right) & = \sqrt{g\hhat} - \sqrt{g\hbar} \approx
    \\
    & \approx \sqrt{g\left(\hbar + \frac{1}{8}\Dx^2\pdiff[2]{\hbar}{x}\right)} - \sqrt{g\hbar} =
    \\
    & = \sqrt{g\hbar\left(1 + \frac{1}{8\hbar}\Dx^2\pdiff[2]{\hbar}{x}\right)} - \sqrt{g\hbar} \approx
    \\
    &\approx \sqrt{g\hbar}\left(1 + \frac{1}{16\hbar}\Dx^2 \pdiff[2]{\hbar}{x}\right) - \sqrt{g\hbar} =
    \\
    & = \frac{1}{16} \Dx^2 \sqrt{\frac{g}{\hbar}}\pdiff[2]{\hbar}{x}
\end{align}
Because $\lpdiff[2]{z_b}{x}$ is negligible, due to the regularization of the bedlevel, we get:
\begin{align}
    {\it Err}\left(\sqrt{g\hhat}\right)  & = \frac{1}{16} \Dx^2 \sqrt{\frac{g}{\hbar}}\ \pdiff[2]{\zeta}{x}
    \\
    & \Rightarrow \frac{1}{16} \Dxi^2 \sqrt{\frac{g}{\hbar}}\pdiff[2]{\zeta}{\xi}, \quad \bunit{\metre\per\second}.
\end{align}
\phantom{text}
%
%--------------------------------------------------------------------------------
\paragraph*{Based on kinetic energy }
Looking to square root of the kinetic energy: $\sqrt{u^2/2} = \half\sqrt{2} \abs{u} = \half\sqrt{2} \abs{q/h}$:
\begin{align}
    {\it Err}\left( \half\sqrt{2}\frac{\qhat}{\hhat} \right) & =  \half\sqrt{2}\left(\frac{\qhat}{\hhat} - \frac{\qbar}{\hbar} \right) \approx
    \half\sqrt{2} \left( \frac{\qbar + \frac{1}{8}\Dx^2\pdiff[2]{\qbar}{x}}{\hbar + \frac{1}{8}\Dx^2\pdiff[2]{\hbar}{x}} - \frac{\qbar}{\hbar} \right) =
    \\
    & = \half\sqrt{2} \left( \frac{\qbar}{\hbar}\frac{1 + \frac{1}{8}\Dx^2\frac{1}{\qbar}\pdiff[2]{\qbar}{x}}{1+\frac{1}{8}\Dx^2\frac{1}{\hbar}\pdiff[2]{\hbar}{x}} - \frac{\qbar}{\hbar} \right) \approx
    \\
    & \approx \half\sqrt{2} \left( \frac{\qbar}{\hbar}
    \left( 1 + \frac{1}{8}\Dx^2\frac{1}{\qbar}\pdiff[2]{\qbar}{x} \right)
    \left( 1 - \frac{1}{8}\Dx^2\frac{1}{\hbar}\pdiff[2]{\hbar}{x} \right) - \frac{\qbar}{\hbar} \right) \approx
    \\
    & \approx
    \half\sqrt{2} \left( \frac{1}{8}\Dx^2\frac{1}{\hbar}\pdiff[2]{\qbar}{x}  -
    \frac{1}{8}\Dx^2\frac{\qbar}{\hbar^2}\pdiff[2]{\hbar}{x} \right)
    \\
    & \Rightarrow \frac{1}{16}\sqrt{2} \Dxi^2 \left( \frac{1}{\hbar} \pdiff[2]{\qbar}{\xi} -
    \frac{\qbar}{\hbar^2}\pdiff[2]{\hbar}{\xi} \right), \quad \bunit{\metre\per\second}.
\end{align}
The error function for artificial viscosity  ${\it Err}_\Psi$ reads (comparable with \citet[eq.\ 42]{Borsboom2001}):
\begin{align}
    {\it Err}_\Psi = \Dxi \overline{x}_\xi  \left( \frac{1}{16} \sqrt{\frac{g}{\hbar}}\abs{D_\xi(\overline\zeta)} +
    \frac{\sqrt{2}}{16} \abs{\frac{1}{\hbar} D_\xi(\qbar) -
        \frac{\qbar}{\hbar^2}D_\xi(\hbar)} \right), \quad \bunit{\square\metre\per\second}
\end{align}
with $D_\xi$ defined as \citep[eq. 35]{Borsboom2001}:
\begin{align}
    D_\xi = \Dxi^2 \pdiff[2]{u}{\xi} \approx u_{i-1} - 2u_{i} + u_{i+1}, \quad u \in \{q, h, \zeta\}
\end{align}

